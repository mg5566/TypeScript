(()=>{"use strict";const e=(e,t,n)=>{const r=n.value;return{configurable:!0,get(){return r.bind(this)}}};var t;!function(e){e[e.Active=0]="Active",e[e.Finished=1]="Finished"}(t||(t={}));class n{constructor(e,t,n,r,s){this.id=e,this.title=t,this.description=n,this.people=r,this.status=s}}class r extends class{constructor(){this.listeners=[]}addListener(e){this.listeners.push(e)}}{constructor(){super(),this.projects=[]}static getInstance(){return this.instance||(this.instance=new r),this.instance}addProject(e,r,s){const i=new n(Math.random().toString(),e,r,s,t.Active);this.projects.push(i),this.updateListeners()}moveProject(e,t){const n=this.projects.find((t=>t.id===e));console.log("moveProject",this.projects,e),console.log("find correct id project",n),n&&n.status!==t&&(n.status=t,this.updateListeners())}updateListeners(){for(const e of this.listeners)e(this.projects.slice())}}const s=r.getInstance(),i=e=>{let t=!0;return e.required&&(t=t&&0!==e.value.toString().trim().length),null!=e.minLength&&"string"==typeof e.value&&(t=t&&e.value.length>=e.minLength),null!=e.maxLength&&"string"==typeof e.value&&(t=t&&e.value.length<=e.maxLength),null!=e.min&&"number"==typeof e.value&&(t=t&&e.value>=e.min),null!=e.max&&"number"==typeof e.value&&(t=t&&e.value<=e.max),t};class l{constructor(e,t,n,r){this.templateElement=document.getElementById(e),this.hostElement=document.getElementById(t);const s=document.importNode(this.templateElement.content,!0);this.element=s.firstElementChild,r&&(this.element.id=r),this.attach(n)}attach(e){this.hostElement.insertAdjacentElement(e?"afterbegin":"beforeend",this.element)}}class o extends l{constructor(){super("project-input","app",!0,"user-input"),this.titleInputElement=this.element.querySelector("#title"),this.descriptionInputElement=this.element.querySelector("#description"),this.peopleInputElement=this.element.querySelector("#people"),this.configure()}configure(){this.element.addEventListener("submit",this.submitHandler)}renderContent(){}gatherUserInput(){const e=this.titleInputElement.value,t=this.descriptionInputElement.value,n=this.peopleInputElement.value,r={value:t,required:!0,minLength:5},s={value:+n,required:!0,min:1,max:5};return i({value:e,required:!0})&&i(r)&&i(s)?[e,t,+n]:void alert("invalid input, please try again")}clearInput(){this.titleInputElement.value="",this.descriptionInputElement.value="",this.peopleInputElement.value=""}submitHandler(e){e.preventDefault();const t=this.gatherUserInput();if(Array.isArray(t)){const[e,n,r]=t;s.addProject(e,n,r),this.clearInput()}}}!function(e,t,n,r){var s,i=arguments.length,l=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(l=(i<3?s(l):i>3?s(t,n,l):s(t,n))||l);i>3&&l&&Object.defineProperty(t,n,l)}([e],o.prototype,"submitHandler",null);var a=function(e,t,n,r){var s,i=arguments.length,l=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(l=(i<3?s(l):i>3?s(t,n,l):s(t,n))||l);return i>3&&l&&Object.defineProperty(t,n,l),l};class c extends l{constructor(e,t){super("single-project",e,!1,t.id),this.project=t,this.configure(),this.renderContent()}get persons(){return 1===this.project.people?"1 person":`${this.project.people} persons`}dragStartHandler(e){e.dataTransfer.setData("text/plain",this.project.id),e.dataTransfer.effectAllowed="move"}dragEndHandler(e){console.log("drag end handler")}configure(){this.element.addEventListener("dragstart",this.dragStartHandler),this.element.addEventListener("dragend",this.dragEndHandler)}renderContent(){this.element.querySelector("h2").textContent=this.project.title,this.element.querySelector("h3").textContent=this.persons+" assigned",this.element.querySelector("p").textContent=this.project.description}}a([e],c.prototype,"dragStartHandler",null),a([e],c.prototype,"dragEndHandler",null);var d=function(e,t,n,r){var s,i=arguments.length,l=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(l=(i<3?s(l):i>3?s(t,n,l):s(t,n))||l);return i>3&&l&&Object.defineProperty(t,n,l),l};class p extends l{constructor(e){super("project-list","app",!1,`${e}-projects`),this.type=e,this.assignedProjects=[],this.configure(),this.renderContent()}dragOverHandler(e){e.dataTransfer&&"text/plain"===e.dataTransfer.types[0]&&(e.preventDefault(),this.element.querySelector("ul").classList.add("droppable"))}dropHandler(e){const n=e.dataTransfer.getData("text/plain");s.moveProject(n,"active"===this.type?t.Active:t.Finished),console.log("drop handler",n)}dragLeaveHandler(e){this.element.querySelector("ul").classList.remove("droppable")}configure(){this.element.addEventListener("dragover",this.dragOverHandler),this.element.addEventListener("dragleave",this.dragLeaveHandler),this.element.addEventListener("drop",this.dropHandler),s.addListener((e=>{const n=e.filter((e=>"active"===this.type?e.status===t.Active:e.status===t.Finished));this.assignedProjects=n,this.renderProjects()}))}renderContent(){const e=`${this.type}-projects-list`;this.element.querySelector("ul").id=e,this.element.querySelector("h2").textContent=this.type.toUpperCase()+"-PROJECTS"}renderProjects(){document.getElementById(`${this.type}-projects-list`).innerHTML="";for(const e of this.assignedProjects)new c(this.element.querySelector("ul").id,e)}}d([e],p.prototype,"dragOverHandler",null),d([e],p.prototype,"dropHandler",null),d([e],p.prototype,"dragLeaveHandler",null),new o,new p("active"),new p("finished")})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QkFBaUJsSCxHQUNLUSxLQUFLMkQsUUFBUU8sY0FBYyxNQUNuQ21DLFVBQVVNLE9BQU8sYUFHL0J0QyxZQUNFckUsS0FBSzJELFFBQVFXLGlCQUFpQixXQUFZdEUsS0FBS21HLGlCQUMvQ25HLEtBQUsyRCxRQUFRVyxpQkFBaUIsWUFBYXRFLEtBQUswRyxrQkFDaEQxRyxLQUFLMkQsUUFBUVcsaUJBQWlCLE9BQVF0RSxLQUFLdUcsYUFFM0NwRSxFQUFheEIsYUFBYUksSUFDeEIsTUFBTTZGLEVBQW1CN0YsRUFBUzhGLFFBQVFDLEdBQ3RCLFdBQWQ5RyxLQUFLaUcsS0FDQWEsRUFBSXRHLFNBQVdQLEVBQWN1QixPQUUvQnNGLEVBQUl0RyxTQUFXUCxFQUFjd0csV0FFdEN6RyxLQUFLa0csaUJBQW1CVSxFQUN4QjVHLEtBQUsrRyxvQkFJVHZDLGdCQUNFLE1BQU13QyxFQUFTLEdBQUdoSCxLQUFLaUcscUJBQ3ZCakcsS0FBSzJELFFBQVFPLGNBQWMsTUFBTzlELEdBQUs0RyxFQUN2Q2hILEtBQUsyRCxRQUFRTyxjQUFjLE1BQU82QixZQUNoQy9GLEtBQUtpRyxLQUFLZ0IsY0FBZ0IsWUFHdEJGLGlCQUNjMUQsU0FBU0MsZUFDM0IsR0FBR3RELEtBQUtpRyxzQkFFRWlCLFVBQVksR0FDeEIsSUFBSyxNQUFNbkYsS0FBZS9CLEtBQUtrRyxpQkFDN0IsSUFBSVgsRUFBWXZGLEtBQUsyRCxRQUFRTyxjQUFjLE1BQU85RCxHQUFJMkIsSUF0RDFELEdBREN4QyxHLG9DQVVELEdBRENBLEcsZ0NBV0QsR0FEQ0EsRyxxQ0N0Q0gsSUFBSXlFLEVBQ0osSUFBSWdDLEVBQVksVUFDaEIsSUFBSUEsRUFBWSxhIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vOS1wcmFjdGljZS1wcm9qZWN0Ly4vc3JjL2RlY29yYXRvcnMvYXV0b2JpbmQudHMiLCJ3ZWJwYWNrOi8vOS1wcmFjdGljZS1wcm9qZWN0Ly4vc3JjL21vZGVscy9wcm9qZWN0LnRzIiwid2VicGFjazovLzktcHJhY3RpY2UtcHJvamVjdC8uL3NyYy9zdGF0ZS9wcm9qZWN0LXN0YXRlLnRzIiwid2VicGFjazovLzktcHJhY3RpY2UtcHJvamVjdC8uL3NyYy91dGlsL3ZhbGlkYXRpb24udHMiLCJ3ZWJwYWNrOi8vOS1wcmFjdGljZS1wcm9qZWN0Ly4vc3JjL2NvbXBvbmVudHMvYmFzZS1jb21wb25lbnQudHMiLCJ3ZWJwYWNrOi8vOS1wcmFjdGljZS1wcm9qZWN0Ly4vc3JjL2NvbXBvbmVudHMvcHJvamVjdC1pbnB1dC50cyIsIndlYnBhY2s6Ly85LXByYWN0aWNlLXByb2plY3QvLi9zcmMvY29tcG9uZW50cy9wcm9qZWN0LWl0ZW0udHMiLCJ3ZWJwYWNrOi8vOS1wcmFjdGljZS1wcm9qZWN0Ly4vc3JjL2NvbXBvbmVudHMvcHJvamVjdC1saXN0LnRzIiwid2VicGFjazovLzktcHJhY3RpY2UtcHJvamVjdC8uL3NyYy9hcHAudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gYXV0byBiaW5kIGRlY29yYXRvclxuZXhwb3J0IGNvbnN0IGF1dG9iaW5kID0gKFxuICBfOiBhbnksXG4gIF8yOiBzdHJpbmcsXG4gIGRlc2NyaXB0b3I6IFByb3BlcnR5RGVzY3JpcHRvclxuKSA9PiB7XG4gIGNvbnN0IG9yaWdpbmFsTWV0aG9kID0gZGVzY3JpcHRvci52YWx1ZTtcbiAgY29uc3QgYWRqRGVzY3JpcHRvcjogUHJvcGVydHlEZXNjcmlwdG9yID0ge1xuICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICBnZXQoKSB7XG4gICAgICBjb25zdCBib3VuZEZuID0gb3JpZ2luYWxNZXRob2QuYmluZCh0aGlzKTtcbiAgICAgIHJldHVybiBib3VuZEZuO1xuICAgIH0sXG4gIH07XG4gIHJldHVybiBhZGpEZXNjcmlwdG9yO1xufTtcbiIsIi8vIHByb2plY3QgdHlwZVxuZXhwb3J0IGVudW0gUHJvamVjdFN0YXR1cyB7XG4gIEFjdGl2ZSxcbiAgRmluaXNoZWQsXG59XG5cbmV4cG9ydCBjbGFzcyBQcm9qZWN0IHtcbiAgY29uc3RydWN0b3IoXG4gICAgcHVibGljIGlkOiBzdHJpbmcsXG4gICAgcHVibGljIHRpdGxlOiBzdHJpbmcsXG4gICAgcHVibGljIGRlc2NyaXB0aW9uOiBzdHJpbmcsXG4gICAgcHVibGljIHBlb3BsZTogbnVtYmVyLFxuICAgIHB1YmxpYyBzdGF0dXM6IFByb2plY3RTdGF0dXNcbiAgKSB7fVxufVxuIiwiaW1wb3J0IHsgUHJvamVjdCwgUHJvamVjdFN0YXR1cyB9IGZyb20gXCIuLi9tb2RlbHMvcHJvamVjdFwiO1xuXG4vLyBwcm9qZWN0IHN0YXRlIG1hbmFnZW1lbnRcbnR5cGUgTGlzdGVuZXI8VD4gPSAoaXRlbXM6IFRbXSkgPT4gdm9pZDtcblxuY2xhc3MgU3RhdGU8VD4ge1xuICBwcm90ZWN0ZWQgbGlzdGVuZXJzOiBMaXN0ZW5lcjxUPltdID0gW107XG5cbiAgYWRkTGlzdGVuZXIobGlzdGVuZXJGbjogTGlzdGVuZXI8VD4pIHtcbiAgICB0aGlzLmxpc3RlbmVycy5wdXNoKGxpc3RlbmVyRm4pO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBQcm9qZWN0U3RhdGUgZXh0ZW5kcyBTdGF0ZTxQcm9qZWN0PiB7XG4gIHByaXZhdGUgcHJvamVjdHM6IFByb2plY3RbXSA9IFtdO1xuICBwcml2YXRlIHN0YXRpYyBpbnN0YW5jZTogUHJvamVjdFN0YXRlO1xuXG4gIHByaXZhdGUgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoKTtcbiAgfVxuXG4gIHN0YXRpYyBnZXRJbnN0YW5jZSgpIHtcbiAgICBpZiAodGhpcy5pbnN0YW5jZSkge1xuICAgICAgcmV0dXJuIHRoaXMuaW5zdGFuY2U7XG4gICAgfVxuICAgIHRoaXMuaW5zdGFuY2UgPSBuZXcgUHJvamVjdFN0YXRlKCk7XG4gICAgcmV0dXJuIHRoaXMuaW5zdGFuY2U7XG4gIH1cblxuICBhZGRQcm9qZWN0KHRpdGxlOiBzdHJpbmcsIGRlc2NyaXB0aW9uOiBzdHJpbmcsIG51bU9mUGVvcGxlOiBudW1iZXIpIHtcbiAgICBjb25zdCBuZXdQcm9qZWN0ID0gbmV3IFByb2plY3QoXG4gICAgICBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKCksXG4gICAgICB0aXRsZSxcbiAgICAgIGRlc2NyaXB0aW9uLFxuICAgICAgbnVtT2ZQZW9wbGUsXG4gICAgICBQcm9qZWN0U3RhdHVzLkFjdGl2ZVxuICAgICk7XG4gICAgdGhpcy5wcm9qZWN0cy5wdXNoKG5ld1Byb2plY3QpO1xuICAgIHRoaXMudXBkYXRlTGlzdGVuZXJzKCk7XG4gIH1cblxuICBtb3ZlUHJvamVjdChwcm9qZWN0SWQ6IHN0cmluZywgbmV3U3RhdHVzOiBQcm9qZWN0U3RhdHVzKSB7XG4gICAgY29uc3QgcHJvamVjdCA9IHRoaXMucHJvamVjdHMuZmluZChcbiAgICAgIChwcm9qZWN0SXRlbSkgPT4gcHJvamVjdEl0ZW0uaWQgPT09IHByb2plY3RJZFxuICAgICk7XG4gICAgY29uc29sZS5sb2coXCJtb3ZlUHJvamVjdFwiLCB0aGlzLnByb2plY3RzLCBwcm9qZWN0SWQpO1xuICAgIGNvbnNvbGUubG9nKFwiZmluZCBjb3JyZWN0IGlkIHByb2plY3RcIiwgcHJvamVjdCk7XG4gICAgaWYgKHByb2plY3QgJiYgcHJvamVjdC5zdGF0dXMgIT09IG5ld1N0YXR1cykge1xuICAgICAgcHJvamVjdC5zdGF0dXMgPSBuZXdTdGF0dXM7XG4gICAgICB0aGlzLnVwZGF0ZUxpc3RlbmVycygpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlTGlzdGVuZXJzKCkge1xuICAgIGZvciAoY29uc3QgbGlzdGVuZXJGbiBvZiB0aGlzLmxpc3RlbmVycykge1xuICAgICAgbGlzdGVuZXJGbih0aGlzLnByb2plY3RzLnNsaWNlKCkpO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgY29uc3QgcHJvamVjdFN0YXRlID0gUHJvamVjdFN0YXRlLmdldEluc3RhbmNlKCk7XG4iLCIvLyB2YWxpZGF0aW9uXG5leHBvcnQgaW50ZXJmYWNlIFZhbGlkYXRhbGJlIHtcbiAgdmFsdWU6IHN0cmluZyB8IG51bWJlcjtcbiAgcmVxdWlyZWQ/OiBib29sZWFuO1xuICBtaW5MZW5ndGg/OiBudW1iZXI7XG4gIG1heExlbmd0aD86IG51bWJlcjtcbiAgbWluPzogbnVtYmVyO1xuICBtYXg/OiBudW1iZXI7XG59XG5cbmV4cG9ydCBjb25zdCB2YWxpZGF0ZSA9ICh2YWxpZGF0YWxiZUlucHV0OiBWYWxpZGF0YWxiZSk6IGJvb2xlYW4gPT4ge1xuICBsZXQgaXNWYWxpZCA9IHRydWU7XG5cbiAgaWYgKHZhbGlkYXRhbGJlSW5wdXQucmVxdWlyZWQpIHtcbiAgICBpc1ZhbGlkID0gaXNWYWxpZCAmJiB2YWxpZGF0YWxiZUlucHV0LnZhbHVlLnRvU3RyaW5nKCkudHJpbSgpLmxlbmd0aCAhPT0gMDtcbiAgfVxuICBpZiAoXG4gICAgdmFsaWRhdGFsYmVJbnB1dC5taW5MZW5ndGggIT0gbnVsbCAmJlxuICAgIHR5cGVvZiB2YWxpZGF0YWxiZUlucHV0LnZhbHVlID09PSBcInN0cmluZ1wiXG4gICkge1xuICAgIGlzVmFsaWQgPVxuICAgICAgaXNWYWxpZCAmJiB2YWxpZGF0YWxiZUlucHV0LnZhbHVlLmxlbmd0aCA+PSB2YWxpZGF0YWxiZUlucHV0Lm1pbkxlbmd0aDtcbiAgfVxuICBpZiAoXG4gICAgdmFsaWRhdGFsYmVJbnB1dC5tYXhMZW5ndGggIT0gbnVsbCAmJlxuICAgIHR5cGVvZiB2YWxpZGF0YWxiZUlucHV0LnZhbHVlID09PSBcInN0cmluZ1wiXG4gICkge1xuICAgIGlzVmFsaWQgPVxuICAgICAgaXNWYWxpZCAmJiB2YWxpZGF0YWxiZUlucHV0LnZhbHVlLmxlbmd0aCA8PSB2YWxpZGF0YWxiZUlucHV0Lm1heExlbmd0aDtcbiAgfVxuICBpZiAoXG4gICAgdmFsaWRhdGFsYmVJbnB1dC5taW4gIT0gbnVsbCAmJlxuICAgIHR5cGVvZiB2YWxpZGF0YWxiZUlucHV0LnZhbHVlID09PSBcIm51bWJlclwiXG4gICkge1xuICAgIGlzVmFsaWQgPSBpc1ZhbGlkICYmIHZhbGlkYXRhbGJlSW5wdXQudmFsdWUgPj0gdmFsaWRhdGFsYmVJbnB1dC5taW47XG4gIH1cbiAgaWYgKFxuICAgIHZhbGlkYXRhbGJlSW5wdXQubWF4ICE9IG51bGwgJiZcbiAgICB0eXBlb2YgdmFsaWRhdGFsYmVJbnB1dC52YWx1ZSA9PT0gXCJudW1iZXJcIlxuICApIHtcbiAgICBpc1ZhbGlkID0gaXNWYWxpZCAmJiB2YWxpZGF0YWxiZUlucHV0LnZhbHVlIDw9IHZhbGlkYXRhbGJlSW5wdXQubWF4O1xuICB9XG4gIHJldHVybiBpc1ZhbGlkO1xufTtcbiIsIi8vIENvbXBvbmVudCBCYXNlIGNsYXNzXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQ29tcG9uZW50PFQgZXh0ZW5kcyBIVE1MRWxlbWVudCwgVSBleHRlbmRzIEhUTUxFbGVtZW50PiB7XG4gIHRlbXBsYXRlRWxlbWVudDogSFRNTFRlbXBsYXRlRWxlbWVudDtcbiAgaG9zdEVsZW1lbnQ6IFQ7XG4gIGVsZW1lbnQ6IFU7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgdGVtcGxhdGVJZDogc3RyaW5nLFxuICAgIGhvc3RFbGVtZW50SWQ6IHN0cmluZyxcbiAgICBpbnNlcnRBdEJlZ2luOiBib29sZWFuLFxuICAgIG5ld0VsZW1lbnRJZD86IHN0cmluZ1xuICApIHtcbiAgICB0aGlzLnRlbXBsYXRlRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFxuICAgICAgdGVtcGxhdGVJZFxuICAgICkgYXMgSFRNTFRlbXBsYXRlRWxlbWVudDtcbiAgICB0aGlzLmhvc3RFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaG9zdEVsZW1lbnRJZCkgYXMgVDtcblxuICAgIGNvbnN0IGltcG9ydGVkTm9kZSA9IGRvY3VtZW50LmltcG9ydE5vZGUoXG4gICAgICB0aGlzLnRlbXBsYXRlRWxlbWVudC5jb250ZW50LFxuICAgICAgdHJ1ZVxuICAgICk7XG4gICAgdGhpcy5lbGVtZW50ID0gaW1wb3J0ZWROb2RlLmZpcnN0RWxlbWVudENoaWxkIGFzIFU7XG4gICAgaWYgKG5ld0VsZW1lbnRJZCkge1xuICAgICAgdGhpcy5lbGVtZW50LmlkID0gbmV3RWxlbWVudElkO1xuICAgIH1cblxuICAgIHRoaXMuYXR0YWNoKGluc2VydEF0QmVnaW4pO1xuICB9XG5cbiAgcHJpdmF0ZSBhdHRhY2goaW5zZXJ0QXRCZWdpbm5pbmc6IGJvb2xlYW4pIHtcbiAgICB0aGlzLmhvc3RFbGVtZW50Lmluc2VydEFkamFjZW50RWxlbWVudChcbiAgICAgIGluc2VydEF0QmVnaW5uaW5nID8gXCJhZnRlcmJlZ2luXCIgOiBcImJlZm9yZWVuZFwiLFxuICAgICAgdGhpcy5lbGVtZW50XG4gICAgKTtcbiAgfVxuXG4gIGFic3RyYWN0IGNvbmZpZ3VyZSgpOiB2b2lkO1xuICBhYnN0cmFjdCByZW5kZXJDb250ZW50KCk6IHZvaWQ7XG59XG4iLCJpbXBvcnQgeyBhdXRvYmluZCB9IGZyb20gXCIuLi9kZWNvcmF0b3JzL2F1dG9iaW5kXCI7XG5pbXBvcnQgeyBwcm9qZWN0U3RhdGUgfSBmcm9tIFwiLi4vc3RhdGUvcHJvamVjdC1zdGF0ZVwiO1xuaW1wb3J0IHsgVmFsaWRhdGFsYmUsIHZhbGlkYXRlIH0gZnJvbSBcIi4uL3V0aWwvdmFsaWRhdGlvblwiO1xuaW1wb3J0IHsgQ29tcG9uZW50IH0gZnJvbSBcIi4vYmFzZS1jb21wb25lbnRcIjtcblxuLy8gcHJvamVjdCBpbnB1dCBjbGFzc1xuZXhwb3J0IGNsYXNzIFByb2plY3RJbnB1dCBleHRlbmRzIENvbXBvbmVudDxIVE1MRGl2RWxlbWVudCwgSFRNTEZvcm1FbGVtZW50PiB7XG4gIHRpdGxlSW5wdXRFbGVtZW50OiBIVE1MSW5wdXRFbGVtZW50O1xuICBkZXNjcmlwdGlvbklucHV0RWxlbWVudDogSFRNTElucHV0RWxlbWVudDtcbiAgcGVvcGxlSW5wdXRFbGVtZW50OiBIVE1MSW5wdXRFbGVtZW50O1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKFwicHJvamVjdC1pbnB1dFwiLCBcImFwcFwiLCB0cnVlLCBcInVzZXItaW5wdXRcIik7XG5cbiAgICB0aGlzLnRpdGxlSW5wdXRFbGVtZW50ID0gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBcIiN0aXRsZVwiXG4gICAgKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xuICAgIHRoaXMuZGVzY3JpcHRpb25JbnB1dEVsZW1lbnQgPSB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgIFwiI2Rlc2NyaXB0aW9uXCJcbiAgICApIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG4gICAgdGhpcy5wZW9wbGVJbnB1dEVsZW1lbnQgPSB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgIFwiI3Blb3BsZVwiXG4gICAgKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xuXG4gICAgdGhpcy5jb25maWd1cmUoKTtcbiAgfVxuXG4gIGNvbmZpZ3VyZSgpIHtcbiAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCB0aGlzLnN1Ym1pdEhhbmRsZXIpO1xuICB9XG5cbiAgcmVuZGVyQ29udGVudCgpIHt9XG5cbiAgcHJpdmF0ZSBnYXRoZXJVc2VySW5wdXQoKTogW3N0cmluZywgc3RyaW5nLCBudW1iZXJdIHwgdm9pZCB7XG4gICAgY29uc3QgZW50ZXJlZFRpdGxlID0gdGhpcy50aXRsZUlucHV0RWxlbWVudC52YWx1ZTtcbiAgICBjb25zdCBlbnRlcmVkRGVzY3JpcHRpb24gPSB0aGlzLmRlc2NyaXB0aW9uSW5wdXRFbGVtZW50LnZhbHVlO1xuICAgIGNvbnN0IGVudGVyZWRQZW9wbGUgPSB0aGlzLnBlb3BsZUlucHV0RWxlbWVudC52YWx1ZTtcblxuICAgIGNvbnN0IHRpdGxlVmFsaWRhdGFibGU6IFZhbGlkYXRhbGJlID0ge1xuICAgICAgdmFsdWU6IGVudGVyZWRUaXRsZSxcbiAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgIH07XG4gICAgY29uc3QgZGVzY3JpcHRpb25WYWxpZGF0YWJsZTogVmFsaWRhdGFsYmUgPSB7XG4gICAgICB2YWx1ZTogZW50ZXJlZERlc2NyaXB0aW9uLFxuICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICBtaW5MZW5ndGg6IDUsXG4gICAgfTtcbiAgICBjb25zdCBwZW9wbGVWYWxpZGF0YWJsZTogVmFsaWRhdGFsYmUgPSB7XG4gICAgICB2YWx1ZTogK2VudGVyZWRQZW9wbGUsXG4gICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgIG1pbjogMSxcbiAgICAgIG1heDogNSxcbiAgICB9O1xuXG4gICAgaWYgKFxuICAgICAgIXZhbGlkYXRlKHRpdGxlVmFsaWRhdGFibGUpIHx8XG4gICAgICAhdmFsaWRhdGUoZGVzY3JpcHRpb25WYWxpZGF0YWJsZSkgfHxcbiAgICAgICF2YWxpZGF0ZShwZW9wbGVWYWxpZGF0YWJsZSlcbiAgICApIHtcbiAgICAgIGFsZXJ0KFwiaW52YWxpZCBpbnB1dCwgcGxlYXNlIHRyeSBhZ2FpblwiKTtcbiAgICAgIHJldHVybjtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIFtlbnRlcmVkVGl0bGUsIGVudGVyZWREZXNjcmlwdGlvbiwgK2VudGVyZWRQZW9wbGVdO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY2xlYXJJbnB1dCgpIHtcbiAgICB0aGlzLnRpdGxlSW5wdXRFbGVtZW50LnZhbHVlID0gXCJcIjtcbiAgICB0aGlzLmRlc2NyaXB0aW9uSW5wdXRFbGVtZW50LnZhbHVlID0gXCJcIjtcbiAgICB0aGlzLnBlb3BsZUlucHV0RWxlbWVudC52YWx1ZSA9IFwiXCI7XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgcHJpdmF0ZSBzdWJtaXRIYW5kbGVyKGV2ZW50OiBFdmVudCkge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgLy8gY29uc29sZS5sb2codGhpcy50aXRsZUlucHV0RWxlbWVudC52YWx1ZSk7XG4gICAgLy8gaW5wdXQgdmFsaWRhdGlvblxuICAgIGNvbnN0IHVzZXJJbnB1dCA9IHRoaXMuZ2F0aGVyVXNlcklucHV0KCk7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkodXNlcklucHV0KSkge1xuICAgICAgY29uc3QgW3RpdGxlLCBkZXNjLCBwZW9wbGVdID0gdXNlcklucHV0O1xuICAgICAgcHJvamVjdFN0YXRlLmFkZFByb2plY3QodGl0bGUsIGRlc2MsIHBlb3BsZSk7XG4gICAgICB0aGlzLmNsZWFySW5wdXQoKTtcbiAgICB9XG4gIH1cbn1cbiIsImltcG9ydCB7IGF1dG9iaW5kIH0gZnJvbSBcIi4uL2RlY29yYXRvcnMvYXV0b2JpbmRcIjtcbmltcG9ydCB7IERyYWdnYWJsZSB9IGZyb20gXCIuLi9tb2RlbHMvZHJhZy1kcm9wXCI7XG5pbXBvcnQgeyBQcm9qZWN0IH0gZnJvbSBcIi4uL21vZGVscy9wcm9qZWN0XCI7XG5pbXBvcnQgeyBDb21wb25lbnQgfSBmcm9tIFwiLi9iYXNlLWNvbXBvbmVudFwiO1xuXG4vLyBwcm9qZWN0IGl0ZW0gY2xhc3NcbmV4cG9ydCBjbGFzcyBQcm9qZWN0SXRlbVxuICBleHRlbmRzIENvbXBvbmVudDxIVE1MVUxpc3RFbGVtZW50LCBIVE1MTElFbGVtZW50PlxuICBpbXBsZW1lbnRzIERyYWdnYWJsZVxue1xuICBwcml2YXRlIHByb2plY3Q6IFByb2plY3Q7XG5cbiAgZ2V0IHBlcnNvbnMoKSB7XG4gICAgaWYgKHRoaXMucHJvamVjdC5wZW9wbGUgPT09IDEpIHtcbiAgICAgIHJldHVybiBcIjEgcGVyc29uXCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBgJHt0aGlzLnByb2plY3QucGVvcGxlfSBwZXJzb25zYDtcbiAgICB9XG4gIH1cblxuICBjb25zdHJ1Y3Rvcihob3N0SWQ6IHN0cmluZywgcHJvamVjdDogUHJvamVjdCkge1xuICAgIHN1cGVyKFwic2luZ2xlLXByb2plY3RcIiwgaG9zdElkLCBmYWxzZSwgcHJvamVjdC5pZCk7XG4gICAgdGhpcy5wcm9qZWN0ID0gcHJvamVjdDtcblxuICAgIHRoaXMuY29uZmlndXJlKCk7XG4gICAgdGhpcy5yZW5kZXJDb250ZW50KCk7XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgZHJhZ1N0YXJ0SGFuZGxlcihldmVudDogRHJhZ0V2ZW50KTogdm9pZCB7XG4gICAgZXZlbnQuZGF0YVRyYW5zZmVyIS5zZXREYXRhKFwidGV4dC9wbGFpblwiLCB0aGlzLnByb2plY3QuaWQpO1xuICAgIGV2ZW50LmRhdGFUcmFuc2ZlciEuZWZmZWN0QWxsb3dlZCA9IFwibW92ZVwiO1xuICB9XG5cbiAgQGF1dG9iaW5kXG4gIGRyYWdFbmRIYW5kbGVyKF86IERyYWdFdmVudCk6IHZvaWQge1xuICAgIGNvbnNvbGUubG9nKFwiZHJhZyBlbmQgaGFuZGxlclwiKTtcbiAgfVxuXG4gIGNvbmZpZ3VyZSgpOiB2b2lkIHtcbiAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdzdGFydFwiLCB0aGlzLmRyYWdTdGFydEhhbmRsZXIpO1xuICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiZHJhZ2VuZFwiLCB0aGlzLmRyYWdFbmRIYW5kbGVyKTtcbiAgfVxuXG4gIHJlbmRlckNvbnRlbnQoKTogdm9pZCB7XG4gICAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCJoMlwiKSEudGV4dENvbnRlbnQgPSB0aGlzLnByb2plY3QudGl0bGU7XG4gICAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCJoM1wiKSEudGV4dENvbnRlbnQgPSB0aGlzLnBlcnNvbnMgKyBcIiBhc3NpZ25lZFwiO1xuICAgIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwicFwiKSEudGV4dENvbnRlbnQgPSB0aGlzLnByb2plY3QuZGVzY3JpcHRpb247XG4gIH1cbn1cbiIsImltcG9ydCB7IGF1dG9iaW5kIH0gZnJvbSBcIi4uL2RlY29yYXRvcnMvYXV0b2JpbmRcIjtcbmltcG9ydCB7IERyYWdUYXJnZXQgfSBmcm9tIFwiLi4vbW9kZWxzL2RyYWctZHJvcFwiO1xuaW1wb3J0IHsgUHJvamVjdCwgUHJvamVjdFN0YXR1cyB9IGZyb20gXCIuLi9tb2RlbHMvcHJvamVjdFwiO1xuaW1wb3J0IHsgcHJvamVjdFN0YXRlIH0gZnJvbSBcIi4uL3N0YXRlL3Byb2plY3Qtc3RhdGVcIjtcbmltcG9ydCB7IENvbXBvbmVudCB9IGZyb20gXCIuL2Jhc2UtY29tcG9uZW50XCI7XG5pbXBvcnQgeyBQcm9qZWN0SXRlbSB9IGZyb20gXCIuL3Byb2plY3QtaXRlbVwiO1xuXG4vLyBwcm9qZWN0IGxpc3QgY2xhc3NcbmV4cG9ydCBjbGFzcyBQcm9qZWN0TGlzdFxuICBleHRlbmRzIENvbXBvbmVudDxIVE1MRGl2RWxlbWVudCwgSFRNTEVsZW1lbnQ+XG4gIGltcGxlbWVudHMgRHJhZ1RhcmdldFxue1xuICBhc3NpZ25lZFByb2plY3RzOiBQcm9qZWN0W107XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSB0eXBlOiBcImFjdGl2ZVwiIHwgXCJmaW5pc2hlZFwiKSB7XG4gICAgc3VwZXIoXCJwcm9qZWN0LWxpc3RcIiwgXCJhcHBcIiwgZmFsc2UsIGAke3R5cGV9LXByb2plY3RzYCk7XG4gICAgdGhpcy5hc3NpZ25lZFByb2plY3RzID0gW107XG5cbiAgICB0aGlzLmNvbmZpZ3VyZSgpO1xuICAgIHRoaXMucmVuZGVyQ29udGVudCgpO1xuICB9XG5cbiAgQGF1dG9iaW5kXG4gIGRyYWdPdmVySGFuZGxlcihldmVudDogRHJhZ0V2ZW50KTogdm9pZCB7XG4gICAgaWYgKGV2ZW50LmRhdGFUcmFuc2ZlciAmJiBldmVudC5kYXRhVHJhbnNmZXIudHlwZXNbMF0gPT09IFwidGV4dC9wbGFpblwiKSB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgY29uc3QgbGlzdEVsZW1lbnQgPSB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcihcInVsXCIpITtcbiAgICAgIGxpc3RFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJkcm9wcGFibGVcIik7XG4gICAgfVxuICB9XG5cbiAgQGF1dG9iaW5kXG4gIGRyb3BIYW5kbGVyKGV2ZW50OiBEcmFnRXZlbnQpOiB2b2lkIHtcbiAgICBjb25zdCBwcm9qZWN0SWQgPSBldmVudC5kYXRhVHJhbnNmZXIhLmdldERhdGEoXCJ0ZXh0L3BsYWluXCIpO1xuICAgIHByb2plY3RTdGF0ZS5tb3ZlUHJvamVjdChcbiAgICAgIHByb2plY3RJZCxcbiAgICAgIHRoaXMudHlwZSA9PT0gXCJhY3RpdmVcIiA/IFByb2plY3RTdGF0dXMuQWN0aXZlIDogUHJvamVjdFN0YXR1cy5GaW5pc2hlZFxuICAgICk7XG4gICAgY29uc29sZS5sb2coXCJkcm9wIGhhbmRsZXJcIiwgcHJvamVjdElkKTtcbiAgfVxuXG4gIEBhdXRvYmluZFxuICBkcmFnTGVhdmVIYW5kbGVyKF86IERyYWdFdmVudCk6IHZvaWQge1xuICAgIGNvbnN0IGxpc3RFbGVtZW50ID0gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCJ1bFwiKSE7XG4gICAgbGlzdEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcImRyb3BwYWJsZVwiKTtcbiAgfVxuXG4gIGNvbmZpZ3VyZSgpIHtcbiAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdvdmVyXCIsIHRoaXMuZHJhZ092ZXJIYW5kbGVyKTtcbiAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdsZWF2ZVwiLCB0aGlzLmRyYWdMZWF2ZUhhbmRsZXIpO1xuICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiZHJvcFwiLCB0aGlzLmRyb3BIYW5kbGVyKTtcblxuICAgIHByb2plY3RTdGF0ZS5hZGRMaXN0ZW5lcigocHJvamVjdHM6IFByb2plY3RbXSkgPT4ge1xuICAgICAgY29uc3QgcmVsZXZlbnRQcm9qZWN0cyA9IHByb2plY3RzLmZpbHRlcigocHJqKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLnR5cGUgPT09IFwiYWN0aXZlXCIpIHtcbiAgICAgICAgICByZXR1cm4gcHJqLnN0YXR1cyA9PT0gUHJvamVjdFN0YXR1cy5BY3RpdmU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHByai5zdGF0dXMgPT09IFByb2plY3RTdGF0dXMuRmluaXNoZWQ7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuYXNzaWduZWRQcm9qZWN0cyA9IHJlbGV2ZW50UHJvamVjdHM7XG4gICAgICB0aGlzLnJlbmRlclByb2plY3RzKCk7XG4gICAgfSk7XG4gIH1cblxuICByZW5kZXJDb250ZW50KCkge1xuICAgIGNvbnN0IGxpc3RJZCA9IGAke3RoaXMudHlwZX0tcHJvamVjdHMtbGlzdGA7XG4gICAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCJ1bFwiKSEuaWQgPSBsaXN0SWQ7XG4gICAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCJoMlwiKSEudGV4dENvbnRlbnQgPVxuICAgICAgdGhpcy50eXBlLnRvVXBwZXJDYXNlKCkgKyBcIi1QUk9KRUNUU1wiO1xuICB9XG5cbiAgcHJpdmF0ZSByZW5kZXJQcm9qZWN0cygpIHtcbiAgICBjb25zdCBsaXN0RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFxuICAgICAgYCR7dGhpcy50eXBlfS1wcm9qZWN0cy1saXN0YFxuICAgICkhIGFzIEhUTUxVTGlzdEVsZW1lbnQ7XG4gICAgbGlzdEVsZW1lbnQuaW5uZXJIVE1MID0gXCJcIjtcbiAgICBmb3IgKGNvbnN0IHByb2plY3RJdGVtIG9mIHRoaXMuYXNzaWduZWRQcm9qZWN0cykge1xuICAgICAgbmV3IFByb2plY3RJdGVtKHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwidWxcIikhLmlkLCBwcm9qZWN0SXRlbSk7XG4gICAgfVxuICB9XG59XG4iLCJpbXBvcnQgeyBQcm9qZWN0SW5wdXQgfSBmcm9tIFwiLi9jb21wb25lbnRzL3Byb2plY3QtaW5wdXRcIjtcbmltcG9ydCB7IFByb2plY3RMaXN0IH0gZnJvbSBcIi4vY29tcG9uZW50cy9wcm9qZWN0LWxpc3RcIjtcblxubmV3IFByb2plY3RJbnB1dCgpO1xubmV3IFByb2plY3RMaXN0KFwiYWN0aXZlXCIpO1xubmV3IFByb2plY3RMaXN0KFwiZmluaXNoZWRcIik7XG4iXSwibmFtZXMiOlsiYXV0b2JpbmQiLCJfIiwiXzIiLCJkZXNjcmlwdG9yIiwib3JpZ2luYWxNZXRob2QiLCJ2YWx1ZSIsImNvbmZpZ3VyYWJsZSIsImdldCIsImJpbmQiLCJ0aGlzIiwiUHJvamVjdFN0YXR1cyIsIlByb2plY3QiLCJjb25zdHJ1Y3RvciIsImlkIiwidGl0bGUiLCJkZXNjcmlwdGlvbiIsInBlb3BsZSIsInN0YXR1cyIsIlByb2plY3RTdGF0ZSIsImxpc3RlbmVycyIsImFkZExpc3RlbmVyIiwibGlzdGVuZXJGbiIsInB1c2giLCJzdXBlciIsInByb2plY3RzIiwic3RhdGljIiwiaW5zdGFuY2UiLCJhZGRQcm9qZWN0IiwibnVtT2ZQZW9wbGUiLCJuZXdQcm9qZWN0IiwiTWF0aCIsInJhbmRvbSIsInRvU3RyaW5nIiwiQWN0aXZlIiwidXBkYXRlTGlzdGVuZXJzIiwibW92ZVByb2plY3QiLCJwcm9qZWN0SWQiLCJuZXdTdGF0dXMiLCJwcm9qZWN0IiwiZmluZCIsInByb2plY3RJdGVtIiwiY29uc29sZSIsImxvZyIsInNsaWNlIiwicHJvamVjdFN0YXRlIiwiZ2V0SW5zdGFuY2UiLCJ2YWxpZGF0ZSIsInZhbGlkYXRhbGJlSW5wdXQiLCJpc1ZhbGlkIiwicmVxdWlyZWQiLCJ0cmltIiwibGVuZ3RoIiwibWluTGVuZ3RoIiwibWF4TGVuZ3RoIiwibWluIiwibWF4IiwiQ29tcG9uZW50IiwidGVtcGxhdGVJZCIsImhvc3RFbGVtZW50SWQiLCJpbnNlcnRBdEJlZ2luIiwibmV3RWxlbWVudElkIiwidGVtcGxhdGVFbGVtZW50IiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImhvc3RFbGVtZW50IiwiaW1wb3J0ZWROb2RlIiwiaW1wb3J0Tm9kZSIsImNvbnRlbnQiLCJlbGVtZW50IiwiZmlyc3RFbGVtZW50Q2hpbGQiLCJhdHRhY2giLCJpbnNlcnRBdEJlZ2lubmluZyIsImluc2VydEFkamFjZW50RWxlbWVudCIsIlByb2plY3RJbnB1dCIsInRpdGxlSW5wdXRFbGVtZW50IiwicXVlcnlTZWxlY3RvciIsImRlc2NyaXB0aW9uSW5wdXRFbGVtZW50IiwicGVvcGxlSW5wdXRFbGVtZW50IiwiY29uZmlndXJlIiwiYWRkRXZlbnRMaXN0ZW5lciIsInN1Ym1pdEhhbmRsZXIiLCJyZW5kZXJDb250ZW50IiwiZ2F0aGVyVXNlcklucHV0IiwiZW50ZXJlZFRpdGxlIiwiZW50ZXJlZERlc2NyaXB0aW9uIiwiZW50ZXJlZFBlb3BsZSIsImRlc2NyaXB0aW9uVmFsaWRhdGFibGUiLCJwZW9wbGVWYWxpZGF0YWJsZSIsImFsZXJ0IiwiY2xlYXJJbnB1dCIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJ1c2VySW5wdXQiLCJBcnJheSIsImlzQXJyYXkiLCJkZXNjIiwiUHJvamVjdEl0ZW0iLCJob3N0SWQiLCJwZXJzb25zIiwiZHJhZ1N0YXJ0SGFuZGxlciIsImRhdGFUcmFuc2ZlciIsInNldERhdGEiLCJlZmZlY3RBbGxvd2VkIiwiZHJhZ0VuZEhhbmRsZXIiLCJ0ZXh0Q29udGVudCIsIlByb2plY3RMaXN0IiwidHlwZSIsImFzc2lnbmVkUHJvamVjdHMiLCJkcmFnT3ZlckhhbmRsZXIiLCJ0eXBlcyIsImNsYXNzTGlzdCIsImFkZCIsImRyb3BIYW5kbGVyIiwiZ2V0RGF0YSIsIkZpbmlzaGVkIiwiZHJhZ0xlYXZlSGFuZGxlciIsInJlbW92ZSIsInJlbGV2ZW50UHJvamVjdHMiLCJmaWx0ZXIiLCJwcmoiLCJyZW5kZXJQcm9qZWN0cyIsImxpc3RJZCIsInRvVXBwZXJDYXNlIiwiaW5uZXJIVE1MIl0sInNvdXJjZVJvb3QiOiIifQ==